
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced topics &#8212; OVITO 3.4.4 documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/rtd.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="shortcut icon" href="../_static/ovito.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Code examples" href="examples.html" />
    <link rel="prev" title="Rendering &amp; visualization" href="rendering.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Code examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="rendering.html" title="Rendering &amp; visualization"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">OVITO 3.4.4 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Advanced topics</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="advanced-topics">
<h1>Advanced topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h1>
<p>This section covers several advanced topics related to OVITO’s scripting interface:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="#saving-loading-pipelines"><span class="std std-ref">Saving and loading pipelines</span></a></p></li>
<li><p><a class="reference internal" href="#multithreading-settings"><span class="std std-ref">Specifying the number of processor cores</span></a></p></li>
</ul>
</div></blockquote>
<div class="section" id="saving-and-loading-pipelines">
<span id="saving-loading-pipelines"></span><h2>Saving and loading pipelines<a class="headerlink" href="#saving-and-loading-pipelines" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../modules/ovito_io.html#ovito.io.export_file" title="ovito.io.export_file"><code class="xref py py-func docutils literal notranslate"><span class="pre">ovito.io.export_file()</span></code></a> function lets you to save the output data computed by a pipeline to disk. But how do
you save the definition of the pipeline itself, including all the modifiers, to a file? The current version of OVITO can
save the entire <em>scene</em> to a .ovito state file using the <a class="reference internal" href="../modules/ovito.html#ovito.Scene.save" title="ovito.Scene.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Scene.save()</span></code></a> method.
Thus, in order to save a <a class="reference internal" href="../modules/ovito_pipeline.html#ovito.pipeline.Pipeline" title="ovito.pipeline.Pipeline"><code class="xref py py-class docutils literal notranslate"><span class="pre">Pipeline</span></code></a> you need to first make it part of the scene using its <a class="reference internal" href="../modules/ovito_pipeline.html#ovito.pipeline.Pipeline.add_to_scene" title="ovito.pipeline.Pipeline.add_to_scene"><code class="xref py py-meth docutils literal notranslate"><span class="pre">add_to_scene()</span></code></a>
method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ovito</span>
<span class="kn">from</span> <span class="nn">ovito.io</span> <span class="k">import</span> <span class="n">import_file</span>
<span class="kn">from</span> <span class="nn">ovito.modifiers</span> <span class="k">import</span> <span class="n">CoordinationAnalysisModifier</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">import_file</span><span class="p">(</span><span class="s2">&quot;input/simulation.dump&quot;</span><span class="p">)</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">modifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CoordinationAnalysisModifier</span><span class="p">(</span><span class="n">cutoff</span> <span class="o">=</span> <span class="mf">3.4</span><span class="p">))</span>
<span class="c1"># ... </span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">add_to_scene</span><span class="p">()</span>
<span class="n">ovito</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;output/mypipeline.ovito&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Unfortunately, there currently exists no corresponding Python function for loading a scene back into memory from a .ovito state file.
The only way to restore the scene state is to <a class="reference internal" href="running.html#preloading-program-state"><span class="std std-ref">preload the .ovito file</span></a> when executing a batch script.
This is done by using the <strong class="command">-o</strong> command line option of the <strong class="program">ovitos</strong> script interpreter:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">ovitos -o mypipeline.ovito script.py</span>
</pre></div>
</div>
<p>The code in <code class="file docutils literal notranslate"><span class="pre">script.py</span></code> will now be executed in a context where the <a class="reference internal" href="../modules/ovito.html#ovito.Scene" title="ovito.Scene"><code class="xref py py-class docutils literal notranslate"><span class="pre">Scene</span></code></a> was already initialized
with the state loaded from the .ovito scene file. Instead of setting up a completely new pipeline, the script can therefore
work with the existing pipeline that was restored from the state file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ovito</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">ovito</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">pipelines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;input/second_file.dump&quot;</span><span class="p">)</span> <span class="c1"># Replace pipeline input.</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">modifiers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">cutoff</span> <span class="o">=</span> <span class="mf">3.1</span>             <span class="c1"># Adjust modifier params.</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="specifying-the-number-of-processor-cores">
<span id="multithreading-settings"></span><h2>Specifying the number of processor cores<a class="headerlink" href="#specifying-the-number-of-processor-cores" title="Permalink to this headline">¶</a></h2>
<p>Some computation functions of OVITO have been parallelized in order to make use
of all available processor cores. This includes, for example, computationally expensive modifiers such as
<a class="reference internal" href="../modules/ovito_modifiers.html#ovito.modifiers.PolyhedralTemplateMatchingModifier" title="ovito.modifiers.PolyhedralTemplateMatchingModifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">PolyhedralTemplateMatchingModifier</span></code></a>, <a class="reference internal" href="../modules/ovito_modifiers.html#ovito.modifiers.ClusterAnalysisModifier" title="ovito.modifiers.ClusterAnalysisModifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">ClusterAnalysisModifier</span></code></a>
or <a class="reference internal" href="../modules/ovito_modifiers.html#ovito.modifiers.ComputePropertyModifier" title="ovito.modifiers.ComputePropertyModifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">ComputePropertyModifier</span></code></a>, and the software-based rendering engines
<a class="reference internal" href="../modules/ovito_vis.html#ovito.vis.TachyonRenderer" title="ovito.vis.TachyonRenderer"><code class="xref py py-class docutils literal notranslate"><span class="pre">TachyonRenderer</span></code></a> and <a class="reference internal" href="../modules/ovito_vis.html#ovito.vis.OSPRayRenderer" title="ovito.vis.OSPRayRenderer"><code class="xref py py-class docutils literal notranslate"><span class="pre">OSPRayRenderer</span></code></a>.</p>
<p>By default, these parallelized algorithms will make use of all available cores of your CPU. This default number is determined by OVITO
using the function <a class="reference external" href="https://doc.qt.io/qtforpython/PySide2/QtCore/QThread.html#PySide2.QtCore.PySide2.QtCore.QThread.idealThreadCount">QThread.idealThreadCount()</a>,
which can be queried as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">PySide2.QtCore</span> <span class="k">import</span> <span class="n">QThread</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">QThread</span><span class="o">.</span><span class="n">idealThreadCount</span><span class="p">())</span>
<span class="go">4</span>
</pre></div>
</div>
<p>Sometimes it is desirable to restrict OVITO to a single CPU core only, for example when running multiple instances
of OVITO in parallel. This can be achieved in two ways. The graphical application <strong class="program">ovito</strong> and the <a class="reference internal" href="running.html#ovitos-interpreter"><span class="std std-ref">script interpreter</span></a> <strong class="program">ovitos</strong> both support the <a class="reference internal" href="running.html#ovitos-nthreads-parameter"><span class="std std-ref">command line parameter</span></a>
<strong class="command">--nthreads</strong>, which allows overriding the number of CPU cores used by parallel algorithms:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ovitos --nthreads <span class="m">1</span> script.py
</pre></div>
</div>
<p>The second option is to set the <code class="docutils literal notranslate"><span class="pre">OVITO_THREAD_COUNT</span></code> environment variable prior to invoking or importing OVITO. This approach
always works: for the GUI application, the script interpreter <strong class="program">ovitos</strong>, but also for scripts running in an external
Python interpreter that imports the <code class="docutils literal notranslate"><span class="pre">ovito</span></code> module:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">OVITO_THREAD_COUNT</span><span class="o">=</span><span class="m">1</span>
python script.py
</pre></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="running.html">OVITO’s Python interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">High-level overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="file_io.html">File I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipelines.html">Data pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_model.html">Data model</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_manipulation.html">Manipulating data</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_modifiers.html">User-defined modifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="rendering.html">Rendering &amp; visualization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Code examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="version_changes.html">OVITO 2.9 Migration Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/ovito.html"><code class="docutils literal notranslate"><span class="pre">ovito</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/ovito_data.html"><code class="docutils literal notranslate"><span class="pre">ovito.data</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/ovito_io.html"><code class="docutils literal notranslate"><span class="pre">ovito.io</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/ovito_io_ase.html"><code class="docutils literal notranslate"><span class="pre">ovito.io.ase</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/ovito_modifiers.html"><code class="docutils literal notranslate"><span class="pre">ovito.modifiers</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/ovito_pipeline.html"><code class="docutils literal notranslate"><span class="pre">ovito.pipeline</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/ovito_vis.html"><code class="docutils literal notranslate"><span class="pre">ovito.vis</span></code></a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="examples.html" title="Code examples"
             >next</a> |</li>
        <li class="right" >
          <a href="rendering.html" title="Rendering &amp; visualization"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">OVITO 3.4.4 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Advanced topics</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021 OVITO GmbH.
    </div>
  </body>
</html>