
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Example M2: Custom order parameter calculation &#8212; OVITO 3.4.4 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/rtd.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="shortcut icon" href="../../../_static/ovito.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Example M3: Color mapping to visualize local lattice orientation" href="visualize_local_lattice_orientation.html" />
    <link rel="prev" title="Example M1: Calculating mean square displacement" href="msd_calculation.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="visualize_local_lattice_orientation.html" title="Example M3: Color mapping to visualize local lattice orientation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="msd_calculation.html" title="Example M1: Calculating mean square displacement"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">OVITO 3.4.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../examples.html" accesskey="U">Code examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Example M2: Custom order parameter calculation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="example-m2-custom-order-parameter-calculation">
<span id="example-order-parameter-calculation"></span><h1>Example M2: Custom order parameter calculation<a class="headerlink" href="#example-m2-custom-order-parameter-calculation" title="Permalink to this headline">¶</a></h1>
<p>In the paper <a class="reference external" href="https://doi.org/10.1103/PhysRevLett.86.5530">[Phys. Rev. Lett. 86, 5530]</a> an order parameter is specified as a means
of labeling an atom in the simulation as belonging to either the liquid or solid fcc crystal phase. In the following we will
develop a custom analysis modifier for OVITO, which calculates this per-atom order parameter.</p>
<p>The order parameter is defined as follows (see the paper for details): For any of the 12 nearest neighbors of a given atom one can compute the distance the neighbor
makes from the ideal fcc positions of the crystal in the given orientation (denoted by vector <strong>r</strong><sub>fcc</sub>). The sum of the distances over the 12 neighbors,
phi = 1/12*sum(| <strong>r</strong><sub>i</sub> - <strong>r</strong><sub>fcc</sub> |), acts as an “order parameter” for the central atom.</p>
<p>Calculating this parameter involves finding the 12 nearest neighbors of each atom and, for each of these neighbors, determining the
closest ideal lattice vector. To find the neighbors, OVITO provides the <a class="reference internal" href="../../../modules/ovito_data.html#ovito.data.NearestNeighborFinder" title="ovito.data.NearestNeighborFinder"><code class="xref py py-class docutils literal notranslate"><span class="pre">NearestNeighborFinder</span></code></a> utility class.
It directly provides the vectors from the central atom to its nearest neighbors.</p>
<p>Let us start by defining some inputs for the order parameter calculation at the global scope:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ovito.data</span> <span class="k">import</span> <span class="n">NearestNeighborFinder</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># The lattice constant of the FCC crystal:</span>
<span class="n">lattice_parameter</span> <span class="o">=</span> <span class="mf">3.6</span> 

<span class="c1"># The list of &lt;110&gt; ideal neighbor vectors of the reference lattice (FCC):</span>
<span class="n">reference_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span>
    <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">),</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">)</span>
<span class="p">])</span>
<span class="c1"># Rescale ideal lattice vectors with lattice constant.</span>
<span class="n">reference_vectors</span> <span class="o">*=</span> <span class="n">lattice_parameter</span>

<span class="c1"># The number of neighbors to take into account per atom:</span>
<span class="n">num_neighbors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference_vectors</span><span class="p">)</span>
</pre></div>
</div>
<p>The actual modifier function needs to create an output particle property, which will store the calculated
order parameter of each atom. Two nested loops run over all input atoms and their 12 nearest neighbors respectively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">modify</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>

    <span class="c1"># Show a status text in the status bar:</span>
    <span class="k">yield</span> <span class="s1">&#39;Calculating order parameters&#39;</span>

    <span class="c1"># Create output particle property.</span>
    <span class="n">order_params</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">particles_</span><span class="o">.</span><span class="n">create_property</span><span class="p">(</span>
        <span class="s1">&#39;Order Parameter&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Prepare neighbor lists.</span>
    <span class="n">neigh_finder</span> <span class="o">=</span> <span class="n">NearestNeighborFinder</span><span class="p">(</span><span class="n">num_neighbors</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    
    <span class="c1"># Request write access to the output property array.</span>
    <span class="k">with</span> <span class="n">order_params</span><span class="p">:</span>

        <span class="c1"># Loop over all particles.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">count</span><span class="p">):</span>
            
            <span class="c1"># Update progress indicator in the status bar</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
            
            <span class="c1"># Stores the order parameter of the current atom</span>
            <span class="n">oparam</span> <span class="o">=</span> <span class="mf">0.0</span>	
            
            <span class="c1"># Loop over neighbors of current atom.</span>
            <span class="k">for</span> <span class="n">neigh</span> <span class="ow">in</span> <span class="n">neigh_finder</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
                
                <span class="c1"># Compute squared deviation of neighbor vector from every </span>
                <span class="c1"># reference vector.</span>
                <span class="n">squared_deviations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                    <span class="n">reference_vectors</span> <span class="o">-</span> <span class="n">neigh</span><span class="o">.</span><span class="n">delta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                
                <span class="c1"># Sum up the contribution from the best-matching vector.</span>
                <span class="n">oparam</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">squared_deviations</span><span class="p">)</span>

            <span class="c1"># Store result in output array.</span>
            <span class="n">order_params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">oparam</span> <span class="o">/</span> <span class="n">num_neighbors</span>		
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">yield</span></code> statements in the modifier function above are only needed to support progress feedback in the
graphical version of OVITO and to give the pipeline system the possibility to interrupt the long-running calculation when needed.</p>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../../index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../running.html">OVITO’s Python interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">High-level overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../file_io.html">File I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pipelines.html">Data pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_model.html">Data model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data_manipulation.html">Manipulating data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../custom_modifiers.html">User-defined modifiers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rendering.html">Rendering &amp; visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advanced_topics.html">Advanced topics</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../examples.html">Code examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../version_changes.html">OVITO 2.9 Migration Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/ovito.html"><code class="docutils literal notranslate"><span class="pre">ovito</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/ovito_data.html"><code class="docutils literal notranslate"><span class="pre">ovito.data</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/ovito_io.html"><code class="docutils literal notranslate"><span class="pre">ovito.io</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/ovito_io_ase.html"><code class="docutils literal notranslate"><span class="pre">ovito.io.ase</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/ovito_modifiers.html"><code class="docutils literal notranslate"><span class="pre">ovito.modifiers</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/ovito_pipeline.html"><code class="docutils literal notranslate"><span class="pre">ovito.pipeline</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/ovito_vis.html"><code class="docutils literal notranslate"><span class="pre">ovito.vis</span></code></a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="visualize_local_lattice_orientation.html" title="Example M3: Color mapping to visualize local lattice orientation"
             >next</a> |</li>
        <li class="right" >
          <a href="msd_calculation.html" title="Example M1: Calculating mean square displacement"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">OVITO 3.4.4 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../examples.html" >Code examples</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Example M2: Custom order parameter calculation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021 OVITO GmbH.
    </div>
  </body>
</html>